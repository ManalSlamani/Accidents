{% extends 'home/welcome.html' %}
{% block page_name %} Tableau de bord {% endblock %}
{% load static %}
{# <script src="https://code.jquery.com/jquery-3.3.1.js"></script>#}
{#<script src="{% static 'js/code/modules/exporting.js' %}"></script>#}
{#<script src="{% static 'js/code/modules/offline-exporting.js' %}"></script>#}
{#<script src="{% static 'js/code/modules/export-data.js' %}"></script>#}
{#<script src="{% static 'js/code/modules/accessibility.js' %}"></script>#}
{#<script src="{% static 'css/bootstrap-4.5.0/bootstrap-4.5.0-dist/js/bootstrap.min.js' %}"></script>#}
{#<script src="{% static 'css/bootstrap-4.5.0/bootstrap-4.5.0-dist/js/bootstrap.js' %}"></script>#}

{#<script src="{% static 'js/jquery-3.5.1.js' %}"></script>#}

{% block content %}

    <style>
table {
  font-family: courier-new, courier, monospace, sans-serif;
  border-collapse: collapse;
  width: 100%;
}

td, th {
    font-family: courier-new, courier, monospace, sans-serif;
  border: 1px solid #dddddd;
  text-align: left;
  height: 15px  ;
  padding: 4px;
}

input[type=date]{
    height: 30px;
    {#display:inline;#}
      }

 input[type=checkbox]{
     margin: 5px;
     margin-right: 7px;
     white-space:pre-line;
    }
    label{
        font-size: 14px;
        margin-left: 6px;
    }
    button{
        height: 40px;
    }
</style>


    <div class="container-fluid">
     <div style="  border-left-style: solid; border-width: 2px; border-color: #34495e">
            <h4 style="padding-left: 4px"> Prédiction de futures accidents routiers en Algérie</h4>
        </div>
    <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item" role="presentation">
            <a class="nav-link active" id="predictions-tab" data-toggle="tab" href="#predictions" role="tab" aria-controls="home" aria-selected="true"><h5>Futures accidents</h5></a>
        </li>
        <li class="nav-item" role="presentation">
            <a class="nav-link" id="predictor-tab" data-toggle="tab" href="#predictor" role="tab" aria-controls="profile" aria-selected="false"><h5>Prédicteur</h5></a>
        </li>
    </ul>
    <div class="tab-content" id="myTabContent">
    <div class="tab-pane fade show active" id="predictions" role="tabpanel" aria-labelledby="predictions-tab"
    style="border-bottom: solid; border-right:solid; border-left: solid; border-width: 1px; border-color: #c4dce8 ">
       <br> <div class="row">
            <div class="col-lg-7">
{#                 <h5 style="border-left-style: groove; padding-left: 3px ">Réulatats du prédicteur "Forets aléatoires"</h5>#}
                 <p style="float: right">Total: {{ total }} accidents prédits pour le {{ mars.date.1.date }}</p>
                <table class="table table-bordered" style="padding-top: 20px; width: 100%; font-size: 12.5px; width: 100%"  >
  <thead>
    <tr class="table-warning">
        <th>#</th>
        <th>Wilaya</th>
      <th >Latitude</th>
      <th >Longitude</th>
      <th>Date</th>
      <th >Heure</th>
      <th>Probabillité</th>
    </tr>
  </thead>

  <tbody>
  <font size="5">
   {% for acc in mars.itertuples %}
       <tr>
           <td > <a href="#acc.Index">{{acc.Index}}</a></td>
       <td>{{ acc.wilaya }}</td>
       <td>{{ acc.Latitude|floatformat:4 }}</td>
       <td>{{ acc.Longitude|floatformat:4 }}</td>
       <td>{{ acc.date.date }}</td>
       <td>{{ acc.HEURE }}</td>
       <td>{{ acc.proba_1|floatformat:4}}</td>
       </tr>
   {% endfor %}
   </font>
  </tbody>
</table>
            </div>
            <div class="col-lg-5">
            <div style="border-style: groove; width: 100%; align-content: center">  {{my_map|safe}} </div><br>
            </div>
        </div>
        <div style="padding-top: 20px">

        </div>
     </div>
    <div class="tab-pane fade" id="predictor" role="tabpanel" aria-labelledby="predictor-tab" style="border-bottom: solid; border-right:solid; border-left: solid; border-width: 1px; border-color: #c4dce8 ">

        {% include 'home/predictor.html' %}

        <br>
        <div class="card border-dark mb-0"  style="padding: 20px; margin: 10px" >
            <b>  <h4>Les forêts aléatoires</h4></b><br>
{#        <div class="row">#}

{#            <div class="col-lg-6">#}
                 <p style="font-size: 14px">
                    L’idée générale derrière la méthode des forêts aléatoires est qu’au lieu d’essayer d’obtenir une méthode optimisée en une fois, plusieurs prédicteurs sont générés avant de mettre en
                     commun leurs différentes prédictions. Elle se base sur l’application de l’approche arbre de décision sur plusieurs échantillons de données et permet d’obtenir des modèles prédictifs
                     pour la classification et la régression. L’aspect aléatoire se présente dans le choix des tests de sélection dans le processus des arbres de décision.
                     Les tests sont choisis aléatoirement dans chaque étape et dans chaque arbre ce qui rend la méthode robuste face au problème de surapprentissage.<br>

                     La forêt est composée d’un ensemble d’arbres de décision où chaque arbre s’entraîne sur
                     une fraction de données nommée a bootstrapped dataset. Pour construire ce dataset, des données sont tirées -avec remise- aléatoirement du dataset original (nous pouvons avoir la même
                     donnée deux fois dans le dataset résultant). C’est le principe de Bootstrap. De plus, et afin que
                     les arbres de notre forêt ne se ressemblent pas trop, un tirage aléatoire sans remise de m features,
                     parmi M en entrée (m < M), est fait pour chaque noeud pour son découpage. Cette variable m
                     est identique pour tous les arbres et les noeuds d’un même arbre, par contre les m variables
                     impliquées dans deux nœuds distincts sont en général différentes. La collection d’arbres obtenus est enfin agrégée (moyenne en régression, vote majoritaire en classification) pour donner le
                     prédicteur Random Forests.

                </p>

{#            </div>#}
{#            <div class="col-lg-6">#}
                 <img src="{% static 'img/RF.gif' %}"  style="width: 80%; border-style: solid; border-width: 1px; display: block;   margin-left: auto;  margin-right: auto;" alt="">
{#            </div>#}
{#        </div>#}
            <br>








    </div></div> <br>
    </div>
    </div>
    </div>

<script>
function humanize(x){
  return x.toFixed(4).replace(/\.?0*$/,'');
}


$(document).ready(function(){
    $('[data-toggle="popover"]').popover();
});


Highcharts.chart('predictionchart', {
    chart: {
        type: 'column'
    },
    title: {
        text: 'Accidents prédits avec leur probabilité d\'occurrence',
    },

    xAxis: {
        categories:[
            {% for entry in mars %}{{ entry.date}} {% if not forloop.last %}, {% endif %}{% endfor %}

        ],
        title: {
            text: 'Date'}
    },

    yAxis:{
        title: {
            text: 'Probabilité'}
    },
    legend: {
        enabled: false,
    },

    series: [
        {   color: '#c0392b',
            data: [
                {% for entry in mars %}{{ entry.proba_1}}{% if not forloop.last %}, {% endif %}{% endfor %}

        ],
             accessibility: {
            exposeAsGroupOnly: true
        },
            }]
});


</script>
<script>
$(document).ready(function(){
    $('a[data-toggle="tab"]').on('show.bs.tab', function(e) {
        localStorage.setItem('activeTab', $(e.target).attr('href'));
    });
    var activeTab = localStorage.getItem('activeTab');
    if(activeTab){
        $('#myTab a[href="' + activeTab + '"]').tab('show');
    }});
{#$(function(){#}
{#    var test = localStorage.input === 'true'? true: false;#}
{#    $('input').prop('checked', test);});#}
{##}
{#$('input').on('change', function() {#}
{#    localStorage.input = $(this).is(':checked');#}
{#    console.log($(this).is(':checked'));});#}


</script>


<script>
$('#myTab a').on('click', function (e) {
  e.preventDefault()
  $(this).tab('show')
})
</script>
{% endblock %}